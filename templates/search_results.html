{% extends "index.html" %}

{% block title %}Search Results{% endblock %}
{% block body_class %}admin-bg{% endblock %}

{% block sidebar_toggle %}
<button class="sidebar-toggle" onclick="document.querySelector('.sidebar').classList.toggle('open')">
  ☰ Menu
</button>
{% endblock %}

{% block sidebar %}
<div class="sidebar">
  <a href="{{ url_for('admin_dashboard') }}">🏠 Dashboard</a>
  <a href="{{ url_for('add_student') }}">➕ Add Student</a>
  <a href="{{ url_for('admin_search') }}" class="active">🔍 Search</a>
  <a href="{{ url_for('change_password_self') }}">🔑 Change Password</a>
  <a class="btn-danger" href="{{ url_for('logout') }}">🚪 Logout</a>
</div>
{% endblock %}

{% block content %}
<div class="container">
  <h2>🔍 Student Search</h2>

  <!-- Search Box -->
  <form method="get" action="{{ url_for('admin_search') }}">
    <input type="text" name="q" placeholder="Search students by name, email or username..." value="{{ q or '' }}">
    <button type="submit">Search</button>
  </form>

  <!-- Results Section -->
  {% if q %}
    <h3>Results for "{{ q }}"</h3>
    {% if students %}
      <div style="display: grid; gap: 12px; margin-top: 16px;">
        {% for s in students %}
          <div class="student-card">
            {% if s.image_filename %}
              <img src="{{ url_for('uploaded_file', filename=s.image_filename) }}" alt="Profile">
            {% else %}
              <img src="{{ url_for('static', filename='default-avatar.png') }}" alt="Profile">
            {% endif %}

            <div>
              <strong>{{ s.name }}</strong><br>
              Username: {{ s.student_username }}<br>
              Phone: {{ s.phone or '-' }}<br>
              CGPA: {{ s.cgpa or '-' }}<br>
              Attendance: {{ s.attendance or 0 }}%<br>
              Scholarship: {% if s.is_scholarship %}{{ s.scholarship_name or 'Yes' }}{% else %}No{% endif %}
            </div>

            <div style="display:inline-flexbox;-ms-flex-direction:column;gap:8px;">
              <a class="btn-box" href="{{ url_for('edit_student', student_id=s.id) }}">✏️ Edit</a>
              <a class="btn-box" href="{{ url_for('reset_password', user_id=s.user_id) }}">🔑 Reset Password</a>
              <form method="post" action="{{ url_for('delete_student', student_id=s.id) }}" 
                    onsubmit="return confirm('Delete student?')">
                <button class="btn btn-danger" style="display: inline-flexbox;" type="submit">🗑 Delete</button>
              </form>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p>No students found for "{{ q }}".</p>
    {% endif %}
  {% else %}
    <p>Type something in the search box above to find students.</p>
  {% endif %}
</div>
{% endblock %}
